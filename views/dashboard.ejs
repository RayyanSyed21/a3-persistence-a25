<% layout('layout') %>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">Welcome, <%= user.username %></h2>
  <form method="post" action="/logout">
    <button class="btn btn-outline-secondary btn-sm">Logout</button>
  </form>
</div>

<div class="mb-4">
  <button id="openResults" class="btn btn-success btn-sm" data-bs-toggle="collapse" data-bs-target="#resultsCollapse" aria-expanded="false" aria-controls="resultsCollapse">Show My Data (Results)</button>
  <div class="collapse mt-3" id="resultsCollapse">
    <div class="card">
      <div class="card-body">
        <pre id="results-json" class="mb-0" aria-label="Your data as JSON"></pre>
      </div>
    </div> 
  </div>
</div>

<h3 class="h5">Add a Car</h3>
<form method="post" action="/cars" class="row g-3 mb-4" aria-describedby="carFormHelp">
  <div class="col-sm-6">
    <label for="model" class="form-label">Model</label>
    <input id="model" class="form-control" type="text" name="model" placeholder="Civic" required>
  </div>
  <div class="col-sm-3">
    <label for="year" class="form-label">Year</label>
    <input id="year" class="form-control" type="number" name="year" min="1990" max="2099" step="1" value="2020" required>
  </div>
  <div class="col-sm-3">
    <label for="mpg" class="form-label">MPG</label>
    <input id="mpg" class="form-control" type="number" name="mpg" min="0" step="0.1" value="30" required>
  </div>
  <div class="col-12">
    <label for="notes" class="form-label">Notes</label>
    <textarea id="notes" class="form-control" name="notes" rows="2" placeholder="Maintenance notes, trim, etc."></textarea>
  </div>
  <div class="col-sm-4">
    <label for="fuel" class="form-label">Fuel</label>
    <select id="fuel" name="fuel" class="form-select">
      <option value="gasoline">Gasoline</option>
      <option value="diesel">Diesel</option>
      <option value="hybrid">Hybrid</option>
      <option value="electric">Electric</option>
    </select>
  </div>
  <div class="col-sm-4">
    <div class="form-check mt-4">
      <input class="form-check-input" type="checkbox" id="isElectric" name="isElectric" value="on">
      <label class="form-check-label" for="isElectric">Is Electric</label>
    </div>
  </div>
  <div class="col-sm-4">
    <span class="form-label d-block">Transmission</span>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="transmission" id="tAuto" value="auto" checked>
      <label class="form-check-label" for="tAuto">Automatic</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="transmission" id="tManual" value="manual">
      <label class="form-check-label" for="tManual">Manual</label>
    </div>
  </div>
  <div class="col-12">
    <button class="btn btn-primary">Add Car</button>
    <div id="carFormHelp" class="form-text">Demonstrates multiple HTML input types per A3 requirements.</div>
  </div>
</form>

<h3 class="h5">Your Cars</h3>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th scope="col">Model</th>
      <th scope="col">Year</th>
      <th scope="col">MPG</th>
      <th scope="col">Fuel</th>
      <th scope="col">Electric</th>
      <th scope="col">Transmission</th>
      <th scope="col">Notes</th>
      <th scope="col">Update</th>
      <th scope="col">Delete</th>
    </tr>
  </thead>
  <tbody>
    <% cars.forEach(car => { %>
      <tr>
        <form method="post" action="/cars/<%= car._id %>/update">
          <td><input type="text" name="model" value="<%= car.model %>" class="form-control"></td>
          <td><input type="number" name="year" value="<%= car.year %>" class="form-control"></td>
          <td><input type="number" name="mpg" value="<%= car.mpg %>" class="form-control"></td>
          <td>
            <select name="fuel" class="form-select">
              <option value="gasoline" <%= car.fuel==='gasoline'?'selected':'' %>>Gasoline</option>
              <option value="diesel" <%= car.fuel==='diesel'?'selected':'' %>>Diesel</option>
              <option value="hybrid" <%= car.fuel==='hybrid'?'selected':'' %>>Hybrid</option>
              <option value="electric" <%= car.fuel==='electric'?'selected':'' %>>Electric</option>
            </select>
          </td>
          <td class="text-center">
            <input type="checkbox" name="isElectric" <%= car.isElectric ? 'checked' : '' %>>
          </td>
          <td>
            <div class="d-flex gap-2">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="transmission" id="auto-<%= car._id %>" value="auto" <%= car.transmission==='auto'?'checked':'' %>>
                <label class="form-check-label" for="auto-<%= car._id %>">Auto</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="transmission" id="manual-<%= car._id %>" value="manual" <%= car.transmission==='manual'?'checked':'' %>>
                <label class="form-check-label" for="manual-<%= car._id %>">Manual</label>
              </div>
            </div>
          </td>
          <td><textarea name="notes" rows="1" class="form-control"><%= car.notes %></textarea></td>
          <td><button class="btn btn-primary btn-sm">Update</button></td>
        </form>
        <td>
          <form method="post" action="/cars/<%= car._id %>/delete">
            <button class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
